{"version":3,"sources":["webpack:///./src/images/kedr2earthsfdp.svg","webpack:///./src/images/kedr2earthsfdp.png","webpack:///./src/pages/telegram-graph.js"],"names":["module","exports","TelegramGraphPage","React","username","setUsername","graphUrl","setGraphUrl","remaining","setRemaining","notFound","setNotFound","imageLoading","setImageLoading","matches","window","location","search","match","handleSubmit","first_time","history","pushState","fetch","then","response","json","status","id","setTimeout","left","className","href","htmlFor","type","name","value","onChange","e","target","onClick","download","replace","style","width","src","onLoad","element","document","querySelector","panzoom","marginTop","textAlign"],"mappings":"gFAAAA,EAAOC,QAAU,IAA0B,8D,yECA3CD,EAAOC,QAAU,IAA0B,8D,kCCA3C,kGAuHeC,UA7GW,WAAO,IAAD,EACEC,aAAzBC,EADuB,KACbC,EADa,OAEEF,aAAzBG,EAFuB,KAEbC,EAFa,OAGIJ,aAA3BK,EAHuB,KAGZC,EAHY,OAIEN,aAAzBO,EAJuB,KAIbC,EAJa,OAKUR,aAAjCS,EALuB,KAKTC,EALS,KAiB9BV,aAAgB,WACd,IAAIW,EAAUC,OAAOC,SAASC,OAAOC,MAAM,cACvCJ,GAAWA,EAAQ,KACrBT,EAAYS,EAAQ,IACpBK,EAAaL,EAAQ,OAEtB,IAGH,IAAMK,EAAe,SAAfA,EAAgBf,EAAUgB,QAAoB,IAApBA,OAAW,GACrCA,IACFb,EAAY,MACZI,EAAY,MACZE,EAAgB,MAChBJ,EAAa,iBACbM,OAAOM,QAAQC,UAAU,KAAM,KAA/B,MAA2ClB,IAE7CmB,MAAM,+CAA+CnB,GAAYoB,MAAK,SAACC,GACrE,OAAOA,EAASC,UACfF,MAAK,SAAAC,GACiB,SAAnBA,EAASE,QACXlB,EAAa,2BACbI,GAAgB,GAChBN,EAAY,oCAAoCkB,EAASG,GAA9C,SACiB,aAAnBH,EAASE,QAClBlB,EAAa,MACbE,GAAY,IACgB,mBAAnBc,EAASE,QAClBlB,EAAa,6BACboB,YAAW,kBAAMV,EAAaf,GAAU,KAAQ,OAEhDK,EAAa,YAAYgB,EAASK,KAAtB,aACZD,YAAW,kBAAMV,EAAaf,GAAU,KAAQ,UAKtD,OACE,wBAAM2B,UAAU,kBACd,gBAAC,IAAD,KACE,oEAEF,uBAAKA,UAAU,aACb,wBAAMA,UAAU,WAAhB,iBADF,IACiD,qBAAGC,KAAK,gDAAR,sBAEjD,uBAAKD,UAAU,gBACb,uBAAKA,UAAU,eACb,2BACE,yBAAOA,UAAU,WAAWE,QAAQ,YAApC,gBAEF,+BAEE,yBACEC,KAAK,OACLC,KAAK,WACLC,MAAOhC,EACPiC,SAAU,SAACC,GAAD,OAAOjC,EAAYiC,EAAEC,OAAOH,UAExC,0BAAQF,KAAK,SAASM,QAAS,kBAAMrB,EAAaf,KAAlD,cAEDI,GAAa,2BACXA,GAEFE,GAAY,uBAAKqB,UAAU,YAAf,oCAGb,2BACE,yBAAOA,UAAU,WAAjB,8FAA6H,2BAD/H,IACsI,2BACpI,yBAAOA,UAAU,WAAjB,uDAAsF,2BAFxF,IAE+F,2BAC7F,yBAAOA,UAAU,WAAjB,4HAA2J,2BAH7J,IAGoK,2BAClK,yBAAOA,UAAU,WAAjB,2DAEDzB,GAAY,2BACX,qBAAG0B,KAAM1B,EAAUmC,UAAQ,GAA3B,iBAEDnC,GAAY,2BACX,qBAAG0B,KAAM1B,EAASoC,QAAQ,OAAQ,QAASD,UAAQ,GAAnD,kBAGJ,uBAAKV,UAAU,UACb,uBAAKH,GAAG,QAAQe,MAAO,CAAEC,MAAO,QAAUC,IAAKvC,EAAUwC,OA1FnD,WAIZrC,EAAa,MACbI,EAAgB,MAChB,IAAIkC,EAAUC,SAASC,cAAc,UACrCC,IAAQH,MAoFDnC,GAAgB,uBAAK+B,MAAO,CAACQ,UAAW,OAAQC,UAAW,WAA3C","file":"component---src-pages-telegram-graph-js-c36782c8d9ef7fe451c0.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/kedr2earthsfdp-9b920a9175ab20ba6b54ab2c9e504b8f.svg\";","module.exports = __webpack_public_path__ + \"static/kedr2earthsfdp-ea8577d794b2a6b8785799b971916301.png\";","import * as React from \"react\"\nimport { Helmet } from \"react-helmet\"\nimport k2e from '../images/kedr2earthsfdp.svg'\nimport k2epng from '../images/kedr2earthsfdp.png'\nimport panzoom from \"panzoom\";\nimport \"../components/layout.css\"\nimport \"../components/graphs.css\"\n\n\n// markup\nconst TelegramGraphPage = () => {\n  const [username, setUsername] = React.useState();\n  const [graphUrl, setGraphUrl] = React.useState();\n  const [remaining, setRemaining] = React.useState();\n  const [notFound, setNotFound] = React.useState();\n  const [imageLoading, setImageLoading] = React.useState();\n\n  const parda = () => {\n    // var element = document.querySelector('#k2e')\n    // console.log(element.width / 2 - window.innerWidth / 2, element.height / 2 - window.innerHeight / 2)\n    // window.scrollTo(element.width / 2 - window.innerWidth / 2, element.height / 2 - window.innerHeight / 2)\n    setRemaining(null);\n    setImageLoading(null)\n    var element = document.querySelector('#graph')\n    panzoom(element)\n  }\n\n  React.useEffect(() => {\n    var matches = window.location.search.match(/\\?q=(.+)&?/)\n    if (matches && matches[1]) {\n      setUsername(matches[1])\n      handleSubmit(matches[1])\n    }\n  }, [])\n\n\n  const handleSubmit = (username, first_time=true) => {\n    if (first_time) {\n      setGraphUrl(null)\n      setNotFound(null)\n      setImageLoading(null)\n      setRemaining(`подготовка...`)\n      window.history.pushState(null, null, `?q=${username}`);\n    }\n    fetch(`https://ruchei.t-a-a-s.ru/getGraph?username=${username}`).then((response) => {\n      return response.json()\n    }).then(response => {\n      if (response.status == 'ready') {\n        setRemaining(\"картинка загружается...\")\n        setImageLoading(true)\n        setGraphUrl(`https://ruchei.t-a-a-s.ru/graphs/${response.id}.svg`)\n      } else if (response.status == 'not_found') {\n        setRemaining(null)\n        setNotFound(true)\n      } else if (response.status == 'preparing_image') {\n        setRemaining(`подготовка изображения...`)\n        setTimeout(() => handleSubmit(username, false), 1000)\n      } else {\n        setRemaining(`осталось ${response.left} шагов...`)\n        setTimeout(() => handleSubmit(username, false), 1000)\n      }\n    })\n  }\n\n  return (\n    <main className=\"telegram-graph\">\n      <Helmet>\n        <title>Telegram Channel Connections graph</title>\n      </Helmet>\n      <div className=\"tg-header\">\n        <span className=\"tg-name\">anton murygin</span> <a href=\"https://t.me/joinchat/ELRK0xksBbAVmNzgYnAmGg\">группа обсуждения</a>\n      </div>\n      <div className=\"tg-container\">\n        <div className=\"tg-controls\">\n          <div>\n            <label className=\"tg-title\" htmlFor=\"username\">граф канала</label>\n          </div>\n          <div>\n            @\n            <input \n              type=\"text\"\n              name=\"username\"\n              value={username}\n              onChange={(e) => setUsername(e.target.value)}\n            />\n            <button type=\"submit\" onClick={() => handleSubmit(username)}>построить</button>\n          </div>\n          {remaining && <div>\n            {remaining}\n          </div>}\n          {notFound && <div className=\"tg-alert\">\n            Чат с таким юзернеймом не найден\n          </div>}\n          <div>\n            <small className=\"tg-desc\">программа получает на вход юзернейм канала и выдает граф связанных репостами с ним каналов</small><br />-<br />\n            <small className=\"tg-desc\">в кружочке - юзернейм, название, кол-во подписчиков</small><br />-<br />\n            <small className=\"tg-desc\">если канал связан с каким-либо каналом не только сам по себе, но и через другой канал - дополнительная связь не строится</small><br />-<br />\n            <small className=\"tg-desc\">навигация по графику - зум колеса мыши и перетягивание</small>\n          </div>\n          {graphUrl && <div>\n            <a href={graphUrl} download>скачать .svg</a>\n          </div>}\n          {graphUrl && <div>\n            <a href={graphUrl.replace('.svg', '.dot')} download>скачать .dot</a>\n          </div>}\n        </div>\n        <div className=\"tg-map\">\n          <img id=\"graph\" style={{ width: '100%' }} src={graphUrl} onLoad={parda} />\n          {imageLoading && <div style={{marginTop: '50vh', textAlign: 'center'}}>\n              картинка загружается...\n            </div>}\n        </div>\n      </div>\n      {/* <img id=\"k2e\" style={{ width: '200%' }} src={k2e} onLoad={parda} /> */}\n      {/* <img id=\"k2e\" style={{width: '100%'}} src={k2epng} onLoad={parda} /> */}\n    </main>\n  )\n}\n\nexport default TelegramGraphPage\n"],"sourceRoot":""}